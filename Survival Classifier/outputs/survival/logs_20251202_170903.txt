Logging to: outputs/survival/logs_20251202_170903.txt
================================================================================
Graph Transformer Survival Predictor
================================================================================

Device: mps
Output directory: outputs/survival
Use clinical features: True
Use genomic features: True

================================================================================
Loading Graph Prior
================================================================================
Loaded STRING prior: 198 proteins, 1184 edges
Computed diffusion kernel and 16 positional encodings

================================================================================
Loading and Preprocessing Data
================================================================================
Loading data from /Users/andykim/Documents/2025 Fall/SMG/Project/SMG_Final_Project/processed_datasets/tcga_pancan_rppa_compiled.csv...
Loaded 7523 samples with 223 columns

Column type identification:
  Identifiers: 2
  Proteins: 198
  Clinical (numeric): 1
  Clinical (categorical): 6
  Genomic: 4
  Survival (targets): 9
  Excluded: 4

================================================================================
Filtering Samples
================================================================================
Protein filter: 7523/7523 samples have ≤50.0% missing proteins
Survival filter: 7201/7523 samples have valid DSS data
Combined: 7201/7523 samples pass all filters

================================================================================
Processing Survival Labels
================================================================================
Survival statistics:
  Events (deaths): 1601 (22.2%)
  Censored: 5600 (77.8%)
  Median survival time: 24.3 months
  Time range: 0.0 - 369.9 months

Survival by cancer type:
  ACC: n=45, events=13 (28.9%), median_time=44.4 months
  BLCA: n=328, events=104 (31.7%), median_time=17.7 months
  BRCA: n=857, events=66 (7.7%), median_time=25.9 months
  CESC: n=163, events=19 (11.7%), median_time=20.4 months
  CHOL: n=29, events=13 (44.8%), median_time=21.0 months
  COAD: n=330, events=45 (13.6%), median_time=21.1 months
  DLBC: n=33, events=2 (6.1%), median_time=24.6 months
  ESCA: n=123, events=24 (19.5%), median_time=12.9 months
  GBM: n=215, events=152 (70.7%), median_time=12.1 months
  HNSC: n=194, events=73 (37.6%), median_time=23.4 months
  KICH: n=62, events=6 (9.7%), median_time=85.7 months
  KIRC: n=446, events=102 (22.9%), median_time=38.7 months
  KIRP: n=206, events=22 (10.7%), median_time=25.0 months
  LGG: n=420, events=89 (21.2%), median_time=20.3 months
  LIHC: n=172, events=53 (30.8%), median_time=17.8 months
  LUAD: n=319, events=79 (24.8%), median_time=23.0 months
  LUSC: n=285, events=60 (21.1%), median_time=23.0 months
  MESO: n=46, events=34 (73.9%), median_time=17.0 months
  OV: n=385, events=210 (54.5%), median_time=33.1 months
  PAAD: n=115, events=56 (48.7%), median_time=15.3 months
  PCPG: n=79, events=1 (1.3%), median_time=26.9 months
  PRAD: n=349, events=4 (1.1%), median_time=32.3 months
  READ: n=111, events=12 (10.8%), median_time=20.0 months
  SARC: n=213, events=66 (31.0%), median_time=30.3 months
  SKCM: n=315, events=132 (41.9%), median_time=33.7 months
  STAD: n=326, events=75 (23.0%), median_time=14.1 months
  TGCT: n=104, events=3 (2.9%), median_time=45.3 months
  THCA: n=363, events=7 (1.9%), median_time=32.3 months
  THYM: n=89, events=3 (3.4%), median_time=34.7 months
  UCEC: n=421, events=46 (10.9%), median_time=28.9 months
  UCS: n=46, events=28 (60.9%), median_time=20.0 months
  UVM: n=12, events=2 (16.7%), median_time=23.5 months

================================================================================
Splitting Data
================================================================================
Data splits:
  Train: 5761 samples (80.0%), 1281 events
  Val:   720 samples (10.0%), 160 events
  Test:  720 samples (10.0%), 160 events

================================================================================
Processing Protein Expression Data
================================================================================
Protein features: 198

================================================================================
Processing Clinical Features
================================================================================
Clinical features: 7

================================================================================
Processing Genomic Features
================================================================================
Genomic features: 4

================================================================================
Preprocessing Complete
================================================================================
Total features per sample:
  Proteins: 198
  Clinical: 7
  Genomic:  4
  TOTAL:    209

Survival task: Predict DSS_STATUS and DSS_MONTHS
  Event rate: 22.2%
  Median follow-up: 24.3 months

Creating DataLoaders...

================================================================================
Initializing Model
================================================================================
Model parameters: 683,269
Feature dimensions:
  - Proteins: 198
  - Clinical: 7
  - Genomic:  4
  - TOTAL:    209

Using reduce_on_plateau learning rate scheduler

================================================================================
Training
================================================================================

Epoch 1/50
--------------------------------------------------------------------------------

Train Loss: 3.5910 | Train C-index: 0.6660
Val Loss:   3.3193 | Val C-index:   0.6621
Learning Rate: 3.00e-04
✓ Saved best model (val_c_index: 0.6621)

Epoch 2/50
--------------------------------------------------------------------------------

Train Loss: 3.3586 | Train C-index: 0.6826
Val Loss:   3.2312 | Val C-index:   0.6737
Learning Rate: 3.00e-04
✓ Saved best model (val_c_index: 0.6737)

Epoch 3/50
--------------------------------------------------------------------------------

Train Loss: 3.3001 | Train C-index: 0.6938
Val Loss:   3.2112 | Val C-index:   0.6773
Learning Rate: 3.00e-04
✓ Saved best model (val_c_index: 0.6773)

Epoch 4/50
--------------------------------------------------------------------------------

Train Loss: 3.2846 | Train C-index: 0.7039
Val Loss:   3.1863 | Val C-index:   0.7016
Learning Rate: 3.00e-04
✓ Saved best model (val_c_index: 0.7016)

Epoch 5/50
--------------------------------------------------------------------------------

Train Loss: 3.2299 | Train C-index: 0.7107
Val Loss:   3.1517 | Val C-index:   0.7074
Learning Rate: 3.00e-04
✓ Saved best model (val_c_index: 0.7074)

Epoch 6/50
--------------------------------------------------------------------------------

Train Loss: 3.2036 | Train C-index: 0.7250
Val Loss:   3.1388 | Val C-index:   0.7162
Learning Rate: 3.00e-04
✓ Saved best model (val_c_index: 0.7162)

Epoch 7/50
--------------------------------------------------------------------------------

Train Loss: 3.1975 | Train C-index: 0.7316
Val Loss:   3.1281 | Val C-index:   0.7328
Learning Rate: 3.00e-04
✓ Saved best model (val_c_index: 0.7328)

Epoch 8/50
--------------------------------------------------------------------------------

Train Loss: 3.1416 | Train C-index: 0.7387
Val Loss:   3.0883 | Val C-index:   0.7449
Learning Rate: 3.00e-04
✓ Saved best model (val_c_index: 0.7449)

Epoch 9/50
--------------------------------------------------------------------------------

Train Loss: 3.1414 | Train C-index: 0.7464
Val Loss:   3.1336 | Val C-index:   0.7380
Learning Rate: 3.00e-04

Epoch 10/50
--------------------------------------------------------------------------------

Train Loss: 3.1215 | Train C-index: 0.7461
Val Loss:   3.0829 | Val C-index:   0.7411
Learning Rate: 3.00e-04

Epoch 11/50
--------------------------------------------------------------------------------

Train Loss: 3.1014 | Train C-index: 0.7561
Val Loss:   3.1074 | Val C-index:   0.7595
Learning Rate: 3.00e-04
✓ Saved best model (val_c_index: 0.7595)

Epoch 12/50
--------------------------------------------------------------------------------

Train Loss: 3.1289 | Train C-index: 0.7514
Val Loss:   3.0778 | Val C-index:   0.7601
Learning Rate: 3.00e-04
✓ Saved best model (val_c_index: 0.7601)

Epoch 13/50
--------------------------------------------------------------------------------

Train Loss: 3.0865 | Train C-index: 0.7597
Val Loss:   3.0591 | Val C-index:   0.7602
Learning Rate: 3.00e-04
✓ Saved best model (val_c_index: 0.7602)

Epoch 14/50
--------------------------------------------------------------------------------

Train Loss: 3.0811 | Train C-index: 0.7654
Val Loss:   3.0423 | Val C-index:   0.7686
Learning Rate: 3.00e-04
✓ Saved best model (val_c_index: 0.7686)

Epoch 15/50
--------------------------------------------------------------------------------

Train Loss: 3.0510 | Train C-index: 0.7677
Val Loss:   3.0185 | Val C-index:   0.7776
Learning Rate: 3.00e-04
✓ Saved best model (val_c_index: 0.7776)

Epoch 16/50
--------------------------------------------------------------------------------

Train Loss: 3.0634 | Train C-index: 0.7732
Val Loss:   3.0718 | Val C-index:   0.7751
Learning Rate: 3.00e-04

Epoch 17/50
--------------------------------------------------------------------------------

Train Loss: 3.0343 | Train C-index: 0.7740
Val Loss:   2.9909 | Val C-index:   0.7793
Learning Rate: 3.00e-04
✓ Saved best model (val_c_index: 0.7793)

Epoch 18/50
--------------------------------------------------------------------------------

Train Loss: 3.0264 | Train C-index: 0.7794
Val Loss:   2.9857 | Val C-index:   0.7864
Learning Rate: 3.00e-04
✓ Saved best model (val_c_index: 0.7864)

Epoch 19/50
--------------------------------------------------------------------------------

Train Loss: 3.0253 | Train C-index: 0.7823
Val Loss:   3.0192 | Val C-index:   0.7746
Learning Rate: 3.00e-04

Epoch 20/50
--------------------------------------------------------------------------------

Train Loss: 3.0130 | Train C-index: 0.7861
Val Loss:   3.0194 | Val C-index:   0.7764
Learning Rate: 3.00e-04

Epoch 21/50
--------------------------------------------------------------------------------

Train Loss: 2.9796 | Train C-index: 0.7947
Val Loss:   3.0028 | Val C-index:   0.7790
Learning Rate: 3.00e-04

Epoch 22/50
--------------------------------------------------------------------------------

Train Loss: 2.9874 | Train C-index: 0.7927
Val Loss:   2.9984 | Val C-index:   0.7717
Learning Rate: 3.00e-04

Epoch 23/50
--------------------------------------------------------------------------------

Train Loss: 2.9606 | Train C-index: 0.7945
Val Loss:   3.0324 | Val C-index:   0.7737
Learning Rate: 3.00e-04

Epoch 24/50
--------------------------------------------------------------------------------

Train Loss: 2.9595 | Train C-index: 0.8056
Val Loss:   3.0021 | Val C-index:   0.7792
Learning Rate: 1.50e-04

Epoch 25/50
--------------------------------------------------------------------------------

Train Loss: 2.9397 | Train C-index: 0.8093
Val Loss:   2.9430 | Val C-index:   0.7888
Learning Rate: 1.50e-04
✓ Saved best model (val_c_index: 0.7888)

Epoch 26/50
--------------------------------------------------------------------------------

Train Loss: 2.9005 | Train C-index: 0.8136
Val Loss:   2.9731 | Val C-index:   0.7819
Learning Rate: 1.50e-04

Epoch 27/50
--------------------------------------------------------------------------------

Train Loss: 2.8874 | Train C-index: 0.8123
Val Loss:   2.9718 | Val C-index:   0.7823
Learning Rate: 1.50e-04

Epoch 28/50
--------------------------------------------------------------------------------

Train Loss: 2.8725 | Train C-index: 0.8172
Val Loss:   2.9782 | Val C-index:   0.7820
Learning Rate: 1.50e-04

Epoch 29/50
--------------------------------------------------------------------------------

Train Loss: 2.8760 | Train C-index: 0.8205
Val Loss:   2.9660 | Val C-index:   0.7806
Learning Rate: 1.50e-04

Epoch 30/50
--------------------------------------------------------------------------------

Train Loss: 2.8376 | Train C-index: 0.8236
Val Loss:   2.9851 | Val C-index:   0.7813
Learning Rate: 1.50e-04

Epoch 31/50
--------------------------------------------------------------------------------

Train Loss: 2.8611 | Train C-index: 0.8253
Val Loss:   2.9788 | Val C-index:   0.7800
Learning Rate: 7.50e-05

Epoch 32/50
--------------------------------------------------------------------------------

Train Loss: 2.8434 | Train C-index: 0.8291
Val Loss:   2.9732 | Val C-index:   0.7798
Learning Rate: 7.50e-05

Epoch 33/50
--------------------------------------------------------------------------------

Train Loss: 2.7843 | Train C-index: 0.8308
Val Loss:   2.9955 | Val C-index:   0.7779
Learning Rate: 7.50e-05

Epoch 34/50
--------------------------------------------------------------------------------

Train Loss: 2.8061 | Train C-index: 0.8298
Val Loss:   3.0078 | Val C-index:   0.7759
Learning Rate: 7.50e-05

Epoch 35/50
--------------------------------------------------------------------------------

Train Loss: 2.8168 | Train C-index: 0.8306
Val Loss:   2.9749 | Val C-index:   0.7751
Learning Rate: 7.50e-05

Early stopping triggered after 35 epochs
Best validation C-index: 0.7888

Training history saved to outputs/survival/results/training_history.json
Training curves saved to outputs/survival/plots/training_curves.png

================================================================================
Testing
================================================================================
Loaded best model from epoch 25
Best validation C-index: 0.7888

Test Set Results:
  Cox Loss:  2.9364
  C-index:   0.7507

C-index interpretation:
  0.50-0.60: Random to weak
  0.60-0.70: Acceptable
  0.70-0.80: Good
  0.80-0.90: Excellent
  0.90-1.00: Outstanding

Test Set Statistics:
  Total samples: 720
  Events (deaths): 160 (22.2%)
  Censored: 560 (77.8%)
  Median time: 23.2 months
  Time range: [0.0, 225.6] months

Risk Score Statistics:
  Mean: -1.1648
  Std:  1.2242
  Min:  -3.8742
  Max:  1.4561
Kaplan-Meier curves saved to outputs/survival/plots/kaplan_meier.png
Risk distribution plot saved to outputs/survival/plots/risk_distribution.png

Test results saved to outputs/survival/results/test_results.json
Test predictions saved to outputs/survival/results/test_predictions.json

================================================================================
Training Complete!
================================================================================

Final Performance:
  Best Val C-index: 0.7888
  Test C-index:     0.7507

All outputs saved to: outputs/survival
  - Logs: outputs/survival/logs_20251202_170903.txt
  - Checkpoints: outputs/survival/checkpoints
  - Results: outputs/survival/results
  - Plots: outputs/survival/plots
