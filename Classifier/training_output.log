Logging to: outputs/logs_20251201_013004.txt
================================================================================
Graph Transformer Cancer Type Classifier
================================================================================

Device: cpu
Output directory: outputs

================================================================================
Loading Graph Prior
================================================================================
Loaded STRING prior: 198 proteins, 1184 edges
Computed diffusion kernel and 16 positional encodings

================================================================================
Loading and Preprocessing Data
================================================================================
Loading data from ../processed_datasets/tcga_pancan_rppa_compiled.csv...
Loaded 7523 samples
Found 198 protein columns in CSV
Filtering samples: 7523/7523 have â‰¤50.0% missing values
After filtering: 7523 samples across 32 cancer types
Cancer type distribution:
CANCER_TYPE_ACRONYM
ACC      45
BLCA    343
BRCA    876
CESC    166
CHOL     30
COAD    346
DLBC     33
ESCA    125
GBM     231
HNSC    211
KICH     62
KIRC    455
KIRP    209
LGG     428
LIHC    179
LUAD    360
LUSC    317
MESO     63
OV      414
PAAD    122
PCPG     79
PRAD    350
READ    118
SARC    218
SKCM    329
STAD    354
TGCT    118
THCA    369
THYM     90
UCEC    423
UCS      48
UVM      12
Name: count, dtype: int64

Data splits:
  Train: 5267 samples (70.0%)
  Val:   1128 samples (15.0%)
  Test:  1128 samples (15.0%)

Handling missing values...
  train: 31893 missing values, imputing with train means
  val: 6812 missing values, imputing with train means
  test: 6748 missing values, imputing with train means

Standardizing protein features...
  Mean: [-0.72382261  0.31138795  0.21224526  0.78764459  1.54569642] ... (first 5)
  Std:  [0.27238704 0.55002089 0.35251095 0.76028943 0.66805306] ... (first 5)

Creating DataLoaders...

================================================================================
Initializing Model
================================================================================
Model parameters: 831,592
Number of proteins: 198
Number of classes: 32
Classes: ['ACC', 'BLCA', 'BRCA', 'CESC', 'CHOL', 'COAD', 'DLBC', 'ESCA', 'GBM', 'HNSC', 'KICH', 'KIRC', 'KIRP', 'LGG', 'LIHC', 'LUAD', 'LUSC', 'MESO', 'OV', 'PAAD', 'PCPG', 'PRAD', 'READ', 'SARC', 'SKCM', 'STAD', 'TGCT', 'THCA', 'THYM', 'UCEC', 'UCS', 'UVM']

================================================================================
Training
================================================================================

Epoch 1/100
--------------------------------------------------------------------------------
Training:   0%|          | 0/83 [00:00<?, ?it/s]/Users/leophelan/miniforge3/lib/python3.12/site-packages/torch/utils/data/dataloader.py:692: UserWarning: 'pin_memory' argument is set as true but not supported on MPS now, device pinned memory won't be used.
  warnings.warn(warn_msg)
Training:   0%|          | 0/83 [00:00<?, ?it/s]
Traceback (most recent call last):
  File "/Users/leophelan/Code/projects/graph_transformer_proteomics/Classifier/train_and_eval.py", line 451, in <module>
    main()
  File "/Users/leophelan/Code/projects/graph_transformer_proteomics/Classifier/train_and_eval.py", line 323, in main
    train_loss, train_acc = train_epoch(
                            ^^^^^^^^^^^^
  File "/Users/leophelan/Code/projects/graph_transformer_proteomics/Classifier/train_and_eval.py", line 97, in train_epoch
    logits = model(x)
             ^^^^^^^^
  File "/Users/leophelan/miniforge3/lib/python3.12/site-packages/torch/nn/modules/module.py", line 1775, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/leophelan/miniforge3/lib/python3.12/site-packages/torch/nn/modules/module.py", line 1786, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/leophelan/Code/projects/graph_transformer_proteomics/Classifier/graph_transformer_classifier.py", line 149, in forward
    tokens = layer(tokens, graph_bias)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/leophelan/miniforge3/lib/python3.12/site-packages/torch/nn/modules/module.py", line 1775, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/leophelan/miniforge3/lib/python3.12/site-packages/torch/nn/modules/module.py", line 1786, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/leophelan/Code/projects/graph_transformer_proteomics/Classifier/graph_transformer_classifier.py", line 237, in forward
    attn_output, _ = self.self_attn(x, x, x, attn_mask=attn_mask, need_weights=False)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/leophelan/miniforge3/lib/python3.12/site-packages/torch/nn/modules/module.py", line 1775, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/leophelan/miniforge3/lib/python3.12/site-packages/torch/nn/modules/module.py", line 1786, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/leophelan/miniforge3/lib/python3.12/site-packages/torch/nn/modules/activation.py", line 1488, in forward
    attn_output, attn_output_weights = F.multi_head_attention_forward(
                                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/leophelan/miniforge3/lib/python3.12/site-packages/torch/nn/functional.py", line 6348, in multi_head_attention_forward
    raise RuntimeError(
RuntimeError: The shape of the 3D attn_mask is torch.Size([64, 199, 199]), but should be (512, 199, 199).
