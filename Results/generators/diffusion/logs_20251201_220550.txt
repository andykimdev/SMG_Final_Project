================================================================================
Graph-Aware Protein Expression Diffusion Model
================================================================================

Device: mps
Output directory: outputs
Logging to: outputs/logs_20251201_220550.txt

================================================================================
Loading Graph Prior
================================================================================
Loaded STRING prior: 198 proteins, 1184 edges
Computed diffusion kernel and 16 positional encodings

================================================================================
Loading and Preprocessing Data
================================================================================
Loading data from ../processed_datasets/tcga_pancan_rppa_compiled.csv...
Loaded 7523 samples
Filtering samples: 7523/7523 have ≤50.0% missing
After filtering: 7523 samples across 32 cancer types
Cancer type distribution:
CANCER_TYPE_ACRONYM
ACC      45
BLCA    343
BRCA    876
CESC    166
CHOL     30
COAD    346
DLBC     33
ESCA    125
GBM     231
HNSC    211
KICH     62
KIRC    455
KIRP    209
LGG     428
LIHC    179
LUAD    360
LUSC    317
MESO     63
OV      414
PAAD    122
PCPG     79
PRAD    350
READ    118
SARC    218
SKCM    329
STAD    354
TGCT    118
THCA    369
THYM     90
UCEC    423
UCS      48
UVM      12
Name: count, dtype: int64

Extracting patient context features...
  Stage cleaning: 4909/7523 valid AJCC stages
  Stage categories: ['STAGE 0', 'STAGE I', 'STAGE I/II (NOS)', 'STAGE IA', 'STAGE IB', 'STAGE II', 'STAGE IIA', 'STAGE IIB', 'STAGE IIC', 'STAGE III', 'STAGE IIIA', 'STAGE IIIB', 'STAGE IIIC', 'STAGE IS', 'STAGE IV', 'STAGE IVA', 'STAGE IVB', 'STAGE IVC', 'STAGE X', 'Unknown']
  Cancer types: 32 categories
  Stages: 20 categories
  Age range: 14.0 - 90.0 years
  Sexes: 3 categories
  Molecular features: 4

Data splits:
  Train: 6395 samples (85.0%)
  Val:   751 samples (10.0%)
  Test:  377 samples (5.0%)

Processing protein expression...
  Mean: [-0.72304177  0.3114389   0.21158511  0.79045542  1.54661482] ... (first 5)
  Std:  [0.27367524 0.55451515 0.34961754 0.76169914 0.6686727 ] ... (first 5)

Creating DataLoaders...

================================================================================
Initializing Model
================================================================================
Loading classifier weights from: /Users/leophelan/Code/projects/graph_transformer_proteomics/Generator/../Classifier/outputs/checkpoints/best_model.pt
Transferred 3 parameters from classifier:
  - Protein embeddings: ✓
  - Graph PE projection: ✓
  - Transformer layers: 0 parameters

New parameters (randomly initialized):
  - Context encoder: 44,401
  - Time embedding: 131,712
  - Noise head: 8,321

Model Summary:
  Total parameters: 1,022,074
  Trainable parameters: 1,022,074

================================================================================
Initializing Diffusion Process
================================================================================
Diffusion timesteps: 1000
Noise schedule: cosine
Loss type: mse

Using EMA with decay=0.9999

================================================================================
Training
================================================================================

Epoch 1/10
--------------------------------------------------------------------------------

Train Loss: 0.595857
Val Loss:   0.489550
Learning Rate: 1.00e-04
✓ Saved best model (val_loss: 0.489550, improvement: inf)

Epoch 2/10
--------------------------------------------------------------------------------

Train Loss: 0.496940
Val Loss:   0.478548
Learning Rate: 1.00e-04
✓ Saved best model (val_loss: 0.478548, improvement: 0.011001)

Epoch 3/10
--------------------------------------------------------------------------------

Train Loss: 0.485327
Val Loss:   0.460797
Learning Rate: 1.00e-04
✓ Saved best model (val_loss: 0.460797, improvement: 0.017752)

Epoch 4/10
--------------------------------------------------------------------------------

Train Loss: 0.479270
Val Loss:   0.457516
Learning Rate: 1.00e-04
✓ Saved best model (val_loss: 0.457516, improvement: 0.003281)

Epoch 5/10
--------------------------------------------------------------------------------

Train Loss: 0.483308
Val Loss:   0.452727
Learning Rate: 1.00e-04
✓ Saved best model (val_loss: 0.452727, improvement: 0.004789)
Saved checkpoint: outputs/checkpoints/checkpoint_epoch5.pt

Epoch 6/10
--------------------------------------------------------------------------------

Train Loss: 0.479446
Val Loss:   0.472117
Learning Rate: 1.00e-04
No improvement for 1 epochs

Epoch 7/10
--------------------------------------------------------------------------------

Train Loss: 0.483825
Val Loss:   0.453403
Learning Rate: 1.00e-04
No improvement for 2 epochs

Epoch 8/10
--------------------------------------------------------------------------------

Train Loss: 0.475001
Val Loss:   0.475254
Learning Rate: 1.00e-04
No improvement for 3 epochs

Epoch 9/10
--------------------------------------------------------------------------------

Train Loss: 0.473520
Val Loss:   0.460596
Learning Rate: 5.00e-05
No improvement for 4 epochs

Epoch 10/10
--------------------------------------------------------------------------------

Train Loss: 0.460307
Val Loss:   0.469660
Learning Rate: 5.00e-05
No improvement for 5 epochs

Early stopping triggered after 10 epochs

Training history saved to outputs/results/training_history.json
Training curves saved to outputs/plots/training_curves.png

================================================================================
Training Complete!
================================================================================

Best validation loss: 0.452727
Total epochs: 10

All outputs saved to: outputs
  - Logs: outputs/logs_20251201_220550.txt
  - Checkpoints: outputs/checkpoints
  - Plots: outputs/plots
  - Results: outputs/results
